{% extends "base.html" %}

{% block "javascript" %}
    <script src="{{ STATIC_URL }}/js/lib/jquery-1.8.3.min.js"></script>
    <script src="{{ STATIC_URL }}/js/lib/django-csrf-ajax.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            var timer;
            $('textarea#id_text').on('keyup', function(event) {
                clearTimeout(timer);
                timer = setTimeout(function() {
                    $.post('/page_preview/', { text: $(event.target).val() }, function(data) {
                        $('#preview').html(data);
                    });
                }, 1 * 1000);
            }).trigger('keyup');
        });
    </script>
{% endblock %}

{% block "sidebar" %}
    {% include "handbook/_sidebar.html" with root_nodes=root_nodes %}
{% endblock %}

{% block "content" %}
    <form action="{{ current_content.node.get_edit_url }}" method="post">{% csrf_token %}
        {{ content_form.text }}
        <br/>
        <input type="submit" value="Save as new version" /> {# TODO cancel-link #}
        <a href="{{ current_content.node.get_url }}">Cancel</a>
    </form>
    <p id="content_meta">Editing version {{ current_content.version }} ({{ current_content.created_at|date:"Y/m/d H:i" }})
    <div id="preview"></div>
{% endblock %}


